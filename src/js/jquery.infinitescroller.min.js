/*!
 * jQuery infiniteScroller - v0.1pre - 9/24/2010
 * http://benalman.com/
 *
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function($){var a="infiniteScroller",b;$.fn[a]=b=function(d){d=$.extend({},b.options,d);var c={Width:"Height",Left:"Top"};$.each(c,function(f,e){if(axis==="x"){c[f]=e=f}c[f.toLowerCase()]=e.toLowerCase()});return this.each(function(){var G=$(this),e=G[0]===document.body?$(window):G,A=G.children(".scroller-content"),q,f,E=A.children(".scroller-loading:first-child"),F=A.children(".scroller-loading:last-child"),u=o(E)||0,x=o(F)||0,H=0,z=0,v,D,w,K;n(false,true);k(q.eq(0));function J(){var L=K;K=g();if(d.pagechange&&L!==K){d.pagechange.call(q.eq(K),q.eq(L))}if(d.scroll){d.scroll.call(G,B(G)-H)}if(d.search_type=="loc_sort_order"){j(-1)}j(1)}J();s();h();e.bind("scroll."+a+" resize."+a,J);G.bind("reflow."+a,s);G.bind("set-zero."+a,h);G.bind("move-to."+a,function(M,L){t(L)});G.bind("move-by."+a,function(M,N){var L={dir:1,amount:r("scroll_by")};N=$.extend(L,typeof N==="number"?{amount:N}:N);if(N.amount==="page"){y(N.dir)}else{i(N.dir*N.amount)}});function s(){n(true);C(K,true)}function n(L,N){q=A.children(".scroller-page");f=[];v=D=B(q.eq(0));q.each(function(O){var P=$(this);L&&p(P,D);f[O]={start:D,end:D+o(P,true)};D+=o(P)});u&&p(E,v-u);x&&p(F,D);var M=I();if(M<0){p(A,u&&x?(o(G)-D)/2:u?o(G)-D:x?v:-M/2)}else{p(A,u-v);if(N){}}}function k(L){L.addClass("scroller-page").data(a,{})}function y(N,M){var L=K+N;L=Math.min(Math.max(L,0),q.length);C(L,M)}function C(L,M){t(q.eq(L),M)}function i(N,L,M){t(N,L,M,true)}function t(W,T,L,X){var Q=d.scroll_duration,Y=B(G),O,U,M,P,S,N,R;if(W&&typeof W!=="number"){if((O=$(W)).length){S=u-v-H-r("offset")[0],N=l(),R=N.start-N.end;U=f[q.index(O)];M=U.start;P=U.end;W=(M-P<R?M:(M+P+R)/2)+S}else{return}}w=Z(X?Y+W:W+H);if(!L){G.stop(true,false);z=0}if(!Q||T){V(w)}else{G.scrollTop(Y).animate({scrollTop:w},{step:function(aa,ab){V(aa-z)},duration:Q})}function Z(ab){var aa=I();return Math.min(Math.max(ab,Math.min(0,aa)),Math.max(0,aa))}function V(aa){e["scroll"+c.Left](Z(aa))}}function j(O){var N=O!==1,S=q.eq(N?0:q.length-1),P=S.data(a),L=d.fetch,M=N?"prev":"next",R=N?u:x,T=B(G),Q=(N?T:I()-T)-R;if(R&&!P[M]&&$.isFunction(L)&&Q<=r("threshold")){P[M]=true;setTimeout(function(){L.call(S,O,function(U){if(U===false){if(N){z+=u;h(H-u);i(-u,true,true);E.hide();u=0}else{F.hide();x=0}n()}else{if(U){var V;U=$(U);k(U);if(N){E.after(U);V=o(U);p(U,B(S)-V);n();h(H+V);i(V,true,true);z-=V}else{F.before(U);p(U,B(S)+o(S));n()}j(O)}else{delete P[M]}}})},1)}}function B(L){return L[0]===G[0]?e["scroll"+c.Left]():L.position()[c.left]}function p(M,N){var L={};if(N!==B(M)){L[c.left]=N;M.css(L)}}function o(L,M){return L[0]===A[0]?u+x+D-v:L[(L[0]===G[0]?"inner":"outer")+c.Width](!M)}function m(M,L){M[c.width](L)}function r(M){var L=d[M];return $.isFunction(L)?L.call(G,o(G)):L}function I(){return o(A)-o(G)}function h(L){H=typeof L==="number"?L:B(G)}function l(){var M=B(G)+v-u,L=r("offset");return{start:M+L[0],end:M+o(G)-L[1]}}function g(){var R=l(),Q=R.start,M=R.end,S,O=[],N=[],L=[],P;$.each(f,function(U,V){var W=V.start,T=V.end;if(W>=M){return false}if(W>=Q){if(T<=M){S=O.push(U)}else{N.push(U)}}else{if(T>Q){N.push(U)}}});L=$.map(S?O:N,function(U){var V=f[U],W=V.start,T=V.end;return{i:U,d:S?Math.abs((Q+M-W-T)/2):W<Q?Q-T:W-M}}).sort(function(U,T){return U.d-T.d});return L.length?L[0].i:0}})};b.options={axis:"x",threshold:function(c){return c},scroll_by:function(c){return c},position:function(d,c){return(d+c)/2},pagechange:function(c){},scroll:function(c){},scroll_duration:400,offset:[0,0],fetch:null}})(jQuery);
/*!
 Simple JavaScript Templating originally by John Resig:
 http://ejohn.org/blog/javascript-micro-templating/
 Modified by Rick Strahl:
 http://west-wind.com/weblog/posts/2008/Oct/13/Client-Templating-with-jQuery
 MIT Licensed
*/
(function(){var b={};this.tmpl=function a(e,d){var c=!/\W/.test(e)?b[e]=b[e]||a(document.getElementById(e).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('")+"');}return p.join('');");return d?c(d):c}})();jQuery.easing.jswing=jQuery.easing.swing;jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(e,f,a,h,g){return jQuery.easing[jQuery.easing.def](e,f,a,h,g)},easeInQuad:function(e,f,a,h,g){return h*(f/=g)*f+a},easeOutQuad:function(e,f,a,h,g){return -h*(f/=g)*(f-2)+a},easeInOutQuad:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f+a}return -h/2*((--f)*(f-2)-1)+a},easeInCubic:function(e,f,a,h,g){return h*(f/=g)*f*f+a},easeOutCubic:function(e,f,a,h,g){return h*((f=f/g-1)*f*f+1)+a},easeInOutCubic:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f*f+a}return h/2*((f-=2)*f*f+2)+a},easeInQuart:function(e,f,a,h,g){return h*(f/=g)*f*f*f+a},easeOutQuart:function(e,f,a,h,g){return -h*((f=f/g-1)*f*f*f-1)+a},easeInOutQuart:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f*f*f+a}return -h/2*((f-=2)*f*f*f-2)+a},easeInQuint:function(e,f,a,h,g){return h*(f/=g)*f*f*f*f+a},easeOutQuint:function(e,f,a,h,g){return h*((f=f/g-1)*f*f*f*f+1)+a},easeInOutQuint:function(e,f,a,h,g){if((f/=g/2)<1){return h/2*f*f*f*f*f+a}return h/2*((f-=2)*f*f*f*f+2)+a},easeInSine:function(e,f,a,h,g){return -h*Math.cos(f/g*(Math.PI/2))+h+a},easeOutSine:function(e,f,a,h,g){return h*Math.sin(f/g*(Math.PI/2))+a},easeInOutSine:function(e,f,a,h,g){return -h/2*(Math.cos(Math.PI*f/g)-1)+a},easeInExpo:function(e,f,a,h,g){return(f==0)?a:h*Math.pow(2,10*(f/g-1))+a},easeOutExpo:function(e,f,a,h,g){return(f==g)?a+h:h*(-Math.pow(2,-10*f/g)+1)+a},easeInOutExpo:function(e,f,a,h,g){if(f==0){return a}if(f==g){return a+h}if((f/=g/2)<1){return h/2*Math.pow(2,10*(f-1))+a}return h/2*(-Math.pow(2,-10*--f)+2)+a},easeInCirc:function(e,f,a,h,g){return -h*(Math.sqrt(1-(f/=g)*f)-1)+a},easeOutCirc:function(e,f,a,h,g){return h*Math.sqrt(1-(f=f/g-1)*f)+a},easeInOutCirc:function(e,f,a,h,g){if((f/=g/2)<1){return -h/2*(Math.sqrt(1-f*f)-1)+a}return h/2*(Math.sqrt(1-(f-=2)*f)+1)+a},easeInElastic:function(f,h,e,l,k){var i=1.70158;var j=0;var g=l;if(h==0){return e}if((h/=k)==1){return e+l}if(!j){j=k*0.3}if(g<Math.abs(l)){g=l;var i=j/4}else{var i=j/(2*Math.PI)*Math.asin(l/g)}return -(g*Math.pow(2,10*(h-=1))*Math.sin((h*k-i)*(2*Math.PI)/j))+e},easeOutElastic:function(f,h,e,l,k){var i=1.70158;var j=0;var g=l;if(h==0){return e}if((h/=k)==1){return e+l}if(!j){j=k*0.3}if(g<Math.abs(l)){g=l;var i=j/4}else{var i=j/(2*Math.PI)*Math.asin(l/g)}return g*Math.pow(2,-10*h)*Math.sin((h*k-i)*(2*Math.PI)/j)+l+e},easeInOutElastic:function(f,h,e,l,k){var i=1.70158;var j=0;var g=l;if(h==0){return e}if((h/=k/2)==2){return e+l}if(!j){j=k*(0.3*1.5)}if(g<Math.abs(l)){g=l;var i=j/4}else{var i=j/(2*Math.PI)*Math.asin(l/g)}if(h<1){return -0.5*(g*Math.pow(2,10*(h-=1))*Math.sin((h*k-i)*(2*Math.PI)/j))+e}return g*Math.pow(2,-10*(h-=1))*Math.sin((h*k-i)*(2*Math.PI)/j)*0.5+l+e},easeInBack:function(e,f,a,i,h,g){if(g==undefined){g=1.70158}return i*(f/=h)*f*((g+1)*f-g)+a},easeOutBack:function(e,f,a,i,h,g){if(g==undefined){g=1.70158}return i*((f=f/h-1)*f*((g+1)*f+g)+1)+a},easeInOutBack:function(e,f,a,i,h,g){if(g==undefined){g=1.70158}if((f/=h/2)<1){return i/2*(f*f*(((g*=(1.525))+1)*f-g))+a}return i/2*((f-=2)*f*(((g*=(1.525))+1)*f+g)+2)+a},easeInBounce:function(e,f,a,h,g){return h-jQuery.easing.easeOutBounce(e,g-f,0,h,g)+a},easeOutBounce:function(e,f,a,h,g){if((f/=g)<(1/2.75)){return h*(7.5625*f*f)+a}else{if(f<(2/2.75)){return h*(7.5625*(f-=(1.5/2.75))*f+0.75)+a}else{if(f<(2.5/2.75)){return h*(7.5625*(f-=(2.25/2.75))*f+0.9375)+a}else{return h*(7.5625*(f-=(2.625/2.75))*f+0.984375)+a}}}},easeInOutBounce:function(e,f,a,h,g){if(f<g/2){return jQuery.easing.easeInBounce(e,f*2,0,h,g)*0.5+a}return jQuery.easing.easeOutBounce(e,f*2-g,0,h,g)*0.5+h*0.5+a}});
/*!
	Stack View - The jQuery virtual stack plugin
	by The Harvard Library Innovation Lab
	
	Dual licensed under MIT and GPL.
*/
(function(f,i,j,c){var m,g="stackView",k,h={};m={init:"stackview.init",item_added:"stackview.itemadded",item_removed:"stackview.itemremoved",page_load:"stackview.pageload"};var b=function(o){var n;f.each(h,function(p,q){if(q.match(o)){n=q;return false}});return n};var e=function(n,r,o){var p=o?"before":"append",q=o?o:n.$element.find(n.options.selectors.item_list);f.each(r,function(t,v){var u=b(v),s;if(u==null){return true}s=f(tmpl(u.template,u.adapter(v,n.options)));s.data("stackviewItem",v);q[p](s)});if(o){o.remove()}};var d=function(n,o){if(o){return}n.$element.find(n.options.selectors.item_list).append(tmpl(k.templates.empty,{message:n.options.emptyMessage}))};var a=function(n){var o=n.options,p;p={start:n.page*n.options.items_per_page,limit:n.options.items_per_page,search_type:n.options.search_type,query:n.options.query};if(p.search_type==="loc_sort_order"){p.start=0;if(n.page===0){n.loc={low:o.id-Math.floor(o.items_per_page/2),high:o.id+Math.floor(o.items_per_page/2)};p.query=["[",n.loc.low,"%20TO%20",n.loc.high,"]"].join("")}else{if(n.direction==="down"){p.query=["[",n.loc.high+1,"%20TO%20",n.loc.high+o.items_per_page+1,"]"].join("");n.loc.high=n.loc.high+o.items_per_page+1}else{if(n.direction==="up"){p.query=["[",n.loc.low-o.items_per_page-1,"%20TO%20",n.loc.low-1,"]"].join("");n.loc.low=n.loc.low-o.items_per_page-1}}}}return p};var l=function(o,r){var q=a(o),n=f.param(q),p;o.page++;p=i.stackCache.get(o.options.url+n);if(p){r(p)}else{f.ajax({url:o.options.url,data:n,dataType:o.options.jsonp?"jsonp":"json",success:function(s){i.stackCache.set(o.options.url+q,s,o.options.cache_ttl);r(s)}})}};k=function(o,n){this.element=o;this.$element=f(o);this.options=f.extend({},k.defaults,n);this.page=0;this.finished={up:false,down:false};this.loc={low:null,high:null};this.direction="down";this.init()};f.extend(true,k,{defaults:{cache_ttl:60,data:"",emptyMessage:"No items found.",id:null,items_per_page:10,jsonp:false,query:"",ribbon:"Stack View",search_type:"keyword",selectors:{item:".stack-item",item_list:".stack-items",ribbon:".ribbon"},url:"basic.json"},utils:{get_heat:function(n){return n===100?10:Math.floor(n/10)+1}},register_type:function(n){h[n.name]=n},get_types:function(){return h}});f.extend(true,k.prototype,{init:function(){var n=this;this.$element.html(tmpl(k.templates.scaffold,{ribbon:this.options.ribbon})).addClass("stackview").bind(m.page_load,function(){n.zIndex()});this.$element.data("stackviewObject",this);this.$element.trigger(m.init);this.next_page()},next_page:function(){var n=f(tmpl(k.templates.placeholder,{})),p=this,o=this.options;if(this.finished.down){return}this.direction="down";if(o.data){if(o.data.docs){e(this,o.data.docs);d(this,o.data.num_found)}else{e(this,o.data);d(this,o.data.length)}this.finished.down=true;this.$element.trigger(m.page_load,[o.data])}else{if(o.url){this.$element.find(o.selectors.item_list).append(n);l(this,function(q){d(p,q.num_found);e(p,q.docs,n);if(parseInt(q.start,10)===-1){p.finished.down=true}p.$element.trigger(m.page_load,[q])})}}},prev_page:function(){var n=f(tmpl(k.templates.placeholder,{})),p=this.options,o=this,q=o.$element.find(p.selectors.item).first();if(p.search_type!=="loc_sort_order"||this.finished.up){return}this.direction="up";this.$element.find(p.selectors.item_list).prepend(n);l(this,function(s){var r=q.position().top;e(o,s.docs,n);if(o.page>1){o.$element.find(p.selectors.item_list).animate({scrollTop:"+="+(q.position().top-r)},0)}if(parseInt(s.start,10)===-1){o.finished.up=true}o.$element.trigger(m.page_load,[s])})},add:function(){var t=this.$element.find(this.options.selectors.item),o,q,p,r,s,n;if(typeof(arguments[0])==="number"){o=arguments[0];q=arguments[1]}else{o=t.length;q=arguments[0]}if(o>t.length||o<0){return}else{if(o===t.length){s=t.last();r="after"}else{s=t.eq(o);r="before"}}p=b(q);if(p==null){return}n=f(tmpl(p.template,p.adapter(q,this.options)));n.data("stackviewItem",q);s[r](n);this.zIndex();this.$element.trigger(m.item_added)},remove:function(n){var r=this.$element.find(this.options.selectors.item),p,q,o;if(typeof(n)==="number"){p=r.eq(n)}else{if(n.nodeType||n.jquery){p=f(n)}else{r.each(function(t,u){var s=f(u);if(s.data("stackviewItem")===n){p=s;return false}})}}if(p==null||!p.length){return}p.detach();q=p.data("stackviewItem");this.$element.trigger(m.item_removed,[q]);return p},getData:function(){var n=[];this.$element.find(this.options.selectors.item).each(function(){n.push(f(this).data("stackviewItem"))});return n},zIndex:function(n){var r=this.$element.find(this.options.selectors.item),p=r.length,o=0,q=n?0:r.length-1;while(o<p){r.eq(o).css("z-index",q);q=q+(n?1:-1);o++}}});f.fn[g]=function(p){var n,o=Array.prototype.slice.call(arguments,1);this.each(function(r,t){var q=f(t),u=q.data("stackviewObject");if(!u){new k(t,p)}else{if(u[p]){var s=u[p].apply(u,o);if(n===c&&s!==c){n=s}}}});return n===c?this:n};i.StackView=k})(jQuery,window,document);(function(c,d){var a=c(document),b;c.extend(StackView.defaults,{infiniteScrollDistance:100});b=function(f){var l=c(f.target),m=l.data("stackviewObject"),e=m.options,g,k,e,h,j,i;g=l.find(e.selectors.item_list);k=l.find(e.selectors.item);h=k.length?k.last().position().top:0;h+=g.scrollTop();j=h-l.height()-e.infiniteScrollDistance;i=function(){if(e.search_type==="loc_sort_order"&&g.scrollTop()<=e.infiniteScrollDistance){g.unbind("scroll.stackview");l.stackView("prev_page")}else{if(g.scrollTop()>=j){g.unbind("scroll.stackview");l.stackView("next_page")}}};g.bind("scroll.stackview",i);i()};a.delegate(".stackview","stackview.pageload",b)})(jQuery);(function(c,d){var b=c(document),a=window.StackView;c.extend(true,a.defaults,{transitionDuration:500,transitionEasing:"easeOutQuad",navigationPercent:80,selectors:{downstream:".downstream",upstream:".upstream",num_items:".num-found span"}});b.delegate(".stackview","stackview.init",function(f){var g=c(f.target),e=g.data("stackviewObject"),i=g.find(e.options.selectors.item_list),h=g.height()*e.options.navigationPercent/100;e.num_found_delta=0;g.prepend(tmpl(a.templates.navigation,{empty:e.options.search_type==="loc_sort_order"}));g.delegate(e.options.selectors.downstream,"click",function(){i.animate({scrollTop:"+="+h},e.options.transitionDuration,e.options.transitionEasing);return false}).delegate(e.options.selectors.upstream,"click",function(){i.animate({scrollTop:"-="+h},e.options.transitionDuration,e.options.transitionEasing);return false})}).delegate(".stackview","stackview.pageload",function(h,i){var j=c(h.target),e=j.data("stackviewObject"),g=i.num_found!=null?parseInt(i.num_found,10):i.length,f;e.num_found=g;f=g+e.num_found_delta;j.find(e.options.selectors.num_items).text(f)}).delegate(".stackview","stackview.itemadded stackview.itemremoved",function(g){var h=c(g.target),e=h.data("stackviewObject"),i=h.find(e.options.selectors.item),f;e.num_found_delta+=(g.namespace==="itemadded"?1:-1);f=e.num_found+e.num_found_delta;h.find(e.options.selectors.num_items).text(f)})})(jQuery);(function(c,d){var b=c(document),a=window.StackView;c.extend(true,a.defaults,{classes:{ministack:"stackview-mini"},ministack:{breakpoint:220,max_height_percentage:100,min_height_percentage:80,page_multiple:0.08}});b.delegate(".stackview","stackview.init",function(f){var g=c(f.target),e=g.data("stackviewObject");if(g.width()<=e.options.ministack.breakpoint){g.addClass(e.options.classes.ministack);c.each(["max_height_percentage","min_height_percentage","page_multiple"],function(h,j){e.options.book[j]=e.options.ministack[j]})}})})(jQuery);window.stackCache=(function(d,f){var b={},e=d.JSON&&(function(){try{return("localStorage" in d)&&d.localStorage!==null}catch(h){return false}})();return{set:g,get:c,remove:a};function g(j,k,h){var i=h&&new Date(+new Date()+h*1000),m={expires:+i,value:k};if(e){try{localStorage[j]=JSON.stringify(m)}catch(l){return l}}else{b[j]=m}}function c(h){var i,j;if(e){i=localStorage[h];if(i){i=JSON.parse(i)}}else{i=b[h]}if(i){if(i.expires&&i.expires<+new Date()){a(h)}else{j=i.value}}return j}function a(h){if(e){localStorage.removeItem(h)}else{delete b[h]}}})(window);(function(a){StackView.templates={scaffold:'			<div class="ribbon"><%= ribbon %></div>			<ul class="stack-items" />',navigation:'			<div class="stack-navigation<%= empty ? " empty" : ""%>">				<div class="upstream">Up</div>				<div class="num-found">					<span></span><br />items				</div>				<div class="downstream">Down</div>			</div>',book:'			<li class="stack-item stack-book heat<%= heat %>" style="width:<%= book_height %>; height:<%= book_thickness %>;">				<a href="<%= link %>" target="_newtab">					<span class="spine-text">						<span class="spine-title"><%= title %></span>						<span class="spine-author"><%= author %></span>					</span>					<span class="spine-year"><%= year %></span>					<span class="stack-pages" />					<span class="stack-cover" />				</a>			</li>',empty:'<li class="stack-item-empty"><%= message %></li>',placeholder:'<li class="stackview-placeholder"></li>'}})();(function(e,d,h){e.extend(true,d.StackView.defaults,{book:{max_height_percentage:100,max_height:39,max_pages:540,min_height_percentage:59,min_height:20,min_pages:200,page_multiple:0.2},selectors:{book:".stack-book"}});var g=function(n,m,j,k,p){var i=j-m,l=p-k,o=(n-m)/(i);return k+o*l};var f=function(l,k){var j=parseInt(k.measurement_height_numeric,10),m=l.book.min_height,i=l.book.max_height;if(isNaN(j)){j=m}j=Math.min(Math.max(j,m),i);j=g(j,l.book.min_height,l.book.max_height,l.book.min_height_percentage,l.book.max_height_percentage);return j+"%"};var b=function(l,k){var n=parseInt(k.measurement_page_numeric,10),m=l.book.min_pages,j=l.book.max_pages,i=l.book.page_multiple;if(isNaN(n)){n=m}n=Math.min(Math.max(n,m),j)*i;return n+"px"};var c=function(i){return i.title_link_friendly?"../shelflife/book/"+i.title_link_friendly+"/"+i.id:i.link};var a=function(j){var i=j.creator&&j.creator.length?j.creator[0]:"";if(/^([^,]*)/.test(i)){i=i.match(/^[^,]*/)}return i};d.StackView.register_type({name:"book",match:function(i){return(i.format&&i.format==="book")||!i.format},adapter:function(j,i){return{heat:d.StackView.utils.get_heat(j.shelfrank),book_height:f(i,j),book_thickness:b(i,j),link:c(j),title:j.title,author:a(j),year:j.pub_date}},template:'			<li class="stack-item stack-book heat<%= heat %>" style="width:<%= book_height %>; height:<%= book_thickness %>;">				<a href="<%= link %>" target="_blank">					<span class="spine-text">						<span class="spine-title"><%= title %></span>						<span class="spine-author"><%= author %></span>					</span>					<span class="spine-year"><%= year %></span>					<span class="stack-pages" />					<span class="stack-cover" />				</a>			</li>'})})(jQuery,window);(function(b,a,c){b.extend(true,a.StackView.defaults,{selectors:{serial:".stack-serial"}});a.StackView.register_type({name:"serial",match:function(d){return d.format==="Serial"},adapter:function(e,d){return{heat:a.StackView.utils.get_heat(e.shelfrank),title:e.title,link:e.link}},template:'			<li class="stack-item stack-serial heat<%= heat %>">				<a href="<%= link %>" target="_blank">					<span class="spine-text">						<span class="spine-title"><%= title %></span>					</span>					<span class="serial-edge" />					<span class="serial-cover" />				</a>			</li>'})})(jQuery,window);(function(b,a,c){b.extend(true,a.StackView.defaults,{selectors:{soundrecording:".stack-soundrecording"}});a.StackView.register_type({name:"soundrecording",match:function(d){return d.format==="Sound Recording"},adapter:function(e,d){return{heat:a.StackView.utils.get_heat(e.shelfrank),link:"#",title:e.title,year:e.pub_date}},template:'			<li class="stack-item stack-soundrecording heat<%= heat %>">				<a href="<%= link %>" target="_blank">						<span class="spine-text">							<span class="spine-title"><%= title %></span>						</span>						<span class="spine-year"><%= year %></span>						<span class="sound-edge"></span>						<span class="sound-cover"></span>				</a>			</li>'})})(jQuery,window);(function(c,b,d){c.extend(true,b.StackView.defaults,{selectors:{videofilm:".stack-videofilm"}});var a=function(e){return e.title?e.title:"#"};b.StackView.register_type({name:"videofilm",match:function(e){return e.format==="Video/Film"},adapter:function(f,e){return{heat:b.StackView.utils.get_heat(f.shelfrank),height:"65%",title:f.title,year:f.pub_date,link:a(f)}},template:'			<li class="stack-item stack-videofilm heat<%= heat %>" style="width:<%= height %>;">				<a href="<%= link %>" target="_blank">					<span class="spine-text">						<span class="spine-title"><%= title %></span>					</span>					<span class="spine-year"><%= year %></span>					<span class="videofilm-edge" />					<span class="videofilm-cover" />				</a>			</li>'})})(jQuery,window);(function(b,a,c){b.extend(true,a.StackView.defaults,{selectors:{webpage:".stack-webpage"}});a.StackView.register_type({name:"webpage",match:function(d){return d.format==="webpage"},adapter:function(e,d){return{heat:a.StackView.utils.get_heat(e.shelfrank),link:e.rsrc_value,publisher:e.publisher,title:e.title}},template:'			<li class="stack-item stack-webpage heat<%= heat %>">				<a href="<%= link %>" target="_blank">					<span class="url-bar">						<span class="url-publisher"><%= publisher %>:</span>						<span class="url-title"><%= title %></span>					</span>					<span class="webpage-top"></span>					<span class="webpage-edge"></span>				</a>			</li>'})})(jQuery,window);